(function(){"use strict";var e={8891:function(e,t,a){var n=a(9242),o=a(3396),r=a(7718),i=a(9271);function d(e,t,a,n,d,s){const l=(0,o.up)("MainPage");return(0,o.wg)(),(0,o.j4)(r.q,null,{default:(0,o.w5)((()=>[(0,o.Wm)(i.O,null,{default:(0,o.w5)((()=>[(0,o.Wm)(l)])),_:1})])),_:1})}var s=a(7139),l=a(870),c=a(265),u=a(6572),m=a(1334),h=a(6824),p=a(8521),f=a(3369),y=a(3289),g=a(6112),b=a(9671),w=a(5503);function D(e,t,a,r,i,d){const D=(0,o.up)("Gantt");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(c._,{height:"100%",elevation:"2",class:"pa-2"},{default:(0,o.w5)((()=>[(0,o.Wm)(u.E,{class:"text-center"},{default:(0,o.w5)((()=>[(0,o.Uk)("病程记录助手")])),_:1}),(0,o.Wm)(g.r,{modelValue:i.symptoms,"onUpdate:modelValue":t[0]||(t[0]=e=>i.symptoms=e),items:i.allSymptoms,chips:"",label:"常见症状添加/删除",multiple:""},null,8,["modelValue","items"]),(0,o.Wm)(h.o,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p.D,{cols:"6"},{default:(0,o.w5)((()=>[(0,o.Wm)(w.hw,{modelValue:i.startDay,"onUpdate:modelValue":t[1]||(t[1]=e=>i.startDay=e),label:"开始日期 (YYYY-MM-DD)",onKeyup:(0,n.D2)(d.updateDay,["enter"]),rules:i.rulesStartDay},null,8,["modelValue","onKeyup","rules"])])),_:1}),(0,o.Wm)(p.D,{cols:"6"},{default:(0,o.w5)((()=>[(0,o.Wm)(w.hw,{modelValue:i.endDay,"onUpdate:modelValue":t[2]||(t[2]=e=>i.endDay=e),label:"结束日期 (YYYY-MM-DD)",onKeyup:(0,n.D2)(d.updateDay,["enter"]),rules:i.rulesEndDay},{default:(0,o.w5)((()=>[(0,o.Wm)(y.t,{onClick:d.updateToday},{default:(0,o.w5)((()=>[(0,o.Uk)("mdi-refresh")])),_:1},8,["onClick"])])),_:1},8,["modelValue","onKeyup","rules"])])),_:1})])),_:1}),(0,o.Wm)(D,{ref:"gantt",data:i.data,itemText:"症状",dateText:"日期",dateRangeList:i.dateRangeList,onScheduleClick:d.scheduleClick},null,8,["data","dateRangeList","onScheduleClick"]),(0,o.Wm)(m.h,{class:"justify-center"},{default:(0,o.w5)((()=>[(0,o.Wm)(l.T,{onClick:i.exportImg},{default:(0,o.w5)((()=>[(0,o.Wm)(y.t,null,{default:(0,o.w5)((()=>[(0,o.Uk)("mdi-cellphone-screenshot")])),_:1}),(0,o.Uk)("点击完整截图")])),_:1},8,["onClick"])])),_:1}),(0,o.Wm)(w.hw,{modelValue:i.newSymptom,"onUpdate:modelValue":t[3]||(t[3]=e=>i.newSymptom=e),label:"添加/删除任意症状",onKeyup:(0,n.D2)(d.addSymptom,["enter"])},null,8,["modelValue","onKeyup"]),(0,o.Wm)(f.K,{class:"text-center pa-0 ma-0"},{default:(0,o.w5)((()=>[(0,o.Wm)(l.T,{onClick:d.addSymptom},{default:(0,o.w5)((()=>[(0,o.Uk)("添加该症状")])),_:1},8,["onClick"]),(0,o.Wm)(l.T,{onClick:d.deleteSymptom},{default:(0,o.w5)((()=>[(0,o.Uk)("删除该症状")])),_:1},8,["onClick"])])),_:1}),(0,o.Wm)(w.hw,{class:"pt-6",modelValue:i.recordedId,"onUpdate:modelValue":t[4]||(t[4]=e=>i.recordedId=e),label:"记录ID（云端匿名保存病程，请保管ID）",rules:i.rulesRecordedId,appendIcon:"mdi-content-copy","onClick:append":d.copyRecordedId},null,8,["modelValue","rules","onClick:append"]),(0,o.Wm)(f.K,{class:"text-center pa-0 ma-0"},{default:(0,o.w5)((()=>[(0,o.Wm)(l.T,{elevation:"1",onClick:d.generateNewIdRecorded,class:"mb-3"},{default:(0,o.w5)((()=>[(0,o.Uk)("生成新ID")])),_:1},8,["onClick"]),(0,o.Wm)(l.T,{elevation:"1",onClick:d.saveRecorded,class:"mb-3",color:"red"},{default:(0,o.w5)((()=>[(0,o.Uk)("保存至云端")])),_:1},8,["onClick"]),(0,o.Wm)(l.T,{elevation:"1",onClick:d.loadRecorded,class:"mb-3"},{default:(0,o.w5)((()=>[(0,o.Uk)("从云端加载")])),_:1},8,["onClick"]),(0,o.Wm)(l.T,{elevation:"1",onClick:d.shareRecorded,class:"mb-3"},{default:(0,o.w5)((()=>[(0,o.Wm)(y.t,null,{default:(0,o.w5)((()=>[(0,o.Uk)("mdi-share-variant")])),_:1}),(0,o.Uk)("分享/复制快捷链接(含ID)")])),_:1},8,["onClick"])])),_:1}),(0,o.Wm)(m.h,{class:"justify-center pt-6"},{default:(0,o.w5)((()=>[(0,o.Wm)(l.T,{href:"https://github.com/xuejianma/SymptomTimeline",target:"_blank"},{default:(0,o.w5)((()=>[(0,o.Wm)(y.t,null,{default:(0,o.w5)((()=>[(0,o.Uk)("mdi-github")])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.Wm)(b.v,{modelValue:i.snackbar,"onUpdate:modelValue":t[6]||(t[6]=e=>i.snackbar=e),timeout:2e3},{actions:(0,o.w5)((()=>[(0,o.Wm)(l.T,{color:"pink",variant:"text",onClick:t[5]||(t[5]=e=>i.snackbar=!1)},{default:(0,o.w5)((()=>[(0,o.Uk)(" Close ")])),_:1})])),default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(i.textSnackbar)+" ",1)])),_:1},8,["modelValue"])],64)}a(7658);var k=a(4870),v=a(850),x=a(7795),_=a(7130);const S={apiKey:"AIzaSyDT6QViLszoCiQIploU5L38QM5rTNWCh7c",authDomain:"symptom-timeline.firebaseapp.com",databaseURL:"https://symptom-timeline-default-rtdb.firebaseio.com",projectId:"symptom-timeline",storageBucket:"symptom-timeline.appspot.com",messagingSenderId:"325790756362",appId:"1:325790756362:web:c0a0fe1b5b92f889db79f3",measurementId:"G-M4VM9ESYEX"},I=(0,x.ZF)(S),C=(0,_.iH)((0,_.N8)()),O=async e=>{if(!e)return void console.log("no id");const t=await(0,_.U2)((0,_.iU)(C,`timelines/${e}`));if(t.exists())return t.val();console.log("No data available")},R=async(e,t)=>{e?await(0,_.t8)((0,_.iU)(C,`timelines/${e}`),t):console.log("no id")};var j={firebaseApp:I,dbRef:C,getData:O,saveData:R},W=a(2483);const T="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",U=11,M=e=>{const t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate();return`${t}-${a<10?"0"+a:a}-${n<10?"0"+n:n}`},V=e=>e.toISOString().split("T")[0];var E=new Date;const P=new Date(E.setDate(E.getDate()-11));E=new Date;const Y=E,L=(0,k.iH)([M(P),M(Y)]),N=()=>{const e=new Date(L.value[0]),t=new Date(L.value[1]);var a=new Date(t.setDate(t.getDate()+1)),n=new Date(e);const o=n.getTimezoneOffset();return o>0&&(n=new Date(n.setDate(n.getDate()+2)),a=new Date(a.setDate(a.getDate()+2))),[V(n),V(a)]},K=(0,k.iH)(N()),A=["发热","咽痒咳嗽","咽干咽痛","乏力","鼻涕","鼻塞","肠胃不适","头痛","关节痛","抗原检测","核酸检测"],H=(0,k.iH)([...A]),q=(0,k.iH)([...A]),z={nan:{color:"#fff",color_text:"gray",name:"nan",name_display:"无"},barely:{color:"#ffd",color_text:"gray",name:"barely",name_display:"微弱"},weak:{color:"#fdd",color_text:"gray",name:"weak",name_display:"轻度"},medium:{color:"#f99",color_text:"#fff",name:"medium",name_display:"中度"},strong:{color:"#f22",color_text:"#fff",name:"strong",name_display:"重度"}},F={data:{},dateRange:L.value,createtime:(new Date).toISOString(),allSymptoms:H.value,symptoms:q.value},Z=(0,k.iH)(null),$=()=>{Z.value.exportImg({download:!0})};var G={name:"MainPage",components:{Gantt:v.ZP},setup(){const e=(0,W.tv)(),t=(0,W.yj)();return{gantt:Z,route:t,router:e}},created(){window.addEventListener("beforeunload",(()=>{this.recordedId&&this.saveRecorded()}))},mounted(){this.router.isReady().then((()=>{this.recordedId=this.route.query.id,this.recordedId&&this.loadRecorded()}))},data(){const e=new Date(L.value[0]),t=new Date(L.value[1]);return{snackbar:!1,textSnackbar:"",dateRange:L,dateRangeList:K,symptoms:q,allSymptoms:H,exportImg:$,recordedId:"",data:this.createData(),newSymptom:"",startDay:V(e),endDay:V(t),rulesStartDay:[e=>!!e||"开始日期不能为空",e=>10===e.length||"开始日期格式不正确",e=>4===e.split("-")[0].length||"开始日期格式不正确",e=>2===e.split("-")[1].length||"开始日期格式不正确",e=>2===e.split("-")[2].length||"开始日期格式不正确",e=>new Date(e)<=new Date(this.endDay)||"开始日期不能晚于结束日期",e=>e<=M(new Date)||"开始日期不能晚于今天"],rulesEndDay:[e=>!!e||"结束日期不能为空",e=>10===e.length||"结束日期格式不正确",e=>4===e.split("-")[0].length||"结束日期格式不正确",e=>2===e.split("-")[1].length||"结束日期格式不正确",e=>2===e.split("-")[2].length||"结束日期格式不正确",e=>new Date(e)>=new Date(this.startDay)||"结束日期不能早于开始日期",e=>e<=M(new Date)||"结束日期不能晚于今天"],rulesRecordedId:[e=>!!e||"ID不能为空，请输入ID或点击“新ID”",e=>e.length===U||"ID格式错误"]}},watch:{symptoms:function(){this.data=this.createData()}},methods:{deleteSymptom(){return""===this.newSymptom?(this.textSnackbar="症状不能为空",void(this.snackbar=!0)):this.allSymptoms.includes(this.newSymptom)?(this.allSymptoms=this.allSymptoms.filter((e=>e!==this.newSymptom)),q.value=q.value.filter((e=>e!==this.newSymptom)),this.data=this.createData(),this.textSnackbar="已删除该症状",void(this.snackbar=!0)):(this.textSnackbar="该症状不存在",void(this.snackbar=!0))},addSymptom(){return this.allSymptoms.includes(this.newSymptom)?(this.textSnackbar="该症状已存在",void(this.snackbar=!0)):""===this.newSymptom?(this.textSnackbar="症状不能为空",void(this.snackbar=!0)):(this.allSymptoms.push(this.newSymptom),this.symptoms.push(this.newSymptom),this.data=this.createData(),this.textSnackbar="已添加该症状",void(this.snackbar=!0))},updateDay(){var e=this.startDay;if(!(e&&10===e.length&&4===e.split("-")[0].length&&2===e.split("-")[1].length&&2===e.split("-")[2].length&&new Date(e)<=new Date(this.endDay)&&e<=M(new Date)))return void console.log("开始日期不合法");if(e=this.endDay,!(e&&10===e.length&&4===e.split("-")[0].length&&2===e.split("-")[1].length&&2===e.split("-")[2].length&&new Date(e)>=new Date(this.startDay)&&e<=M(new Date)))return void console.log("结束日期不合法");const t=new Date(this.startDay),a=new Date(this.endDay);L.value[0]=V(t),L.value[1]=V(a),K.value=N(),this.data=this.createData()},updateToday(){this.endDay=M(new Date),this.updateDay()},createData(){const e=[],t=[],a=new Date(K.value[0]),n=new Date(K.value[1]),o=(new Date).getTimezoneOffset();o>0&&(a.setDate(a.getDate()-2),n.setDate(n.getDate()-2));for(let r=a;r<n;r.setDate(r.getDate()+1))t.push(V(new Date(r)));return q.value.forEach((a=>{e.push({type:"normal",color:"",name:a,schedule:t.map((e=>{if(F.data[a]&&F.data[a][e]){const t=F.data[a][e],n=z[t].color,o=z[t].color_text;return{id:this.uuid(),name:z[t].name_display,desc:"",backgroundColor:n,textColor:o,days:[e]}}return{id:this.uuid(),name:z.nan.name_display,desc:"",backgroundColor:z.nan.color,textColor:z.nan.color_text,days:[e]}}))})})),e},scheduleClick(e){if("normal"===e.type)return;const t=this.data.findIndex((t=>-1!==t.schedule.findIndex((t=>t.id===e.id)))),a=this.data[t].schedule.findIndex((t=>t.id===e.id));e=this.data[t].schedule[a],e.name===z.nan.name_display?(e.name=z.barely.name_display,e.backgroundColor=z.barely.color,e.textColor=z.barely.color_text,F.data[this.data[t].name]||(F.data[this.data[t].name]={}),F.data[this.data[t].name][e.days[0]]=Object.keys(z).find((t=>z[t].name_display===e.name))):e.name===z.barely.name_display?(e.name=z.weak.name_display,e.backgroundColor=z.weak.color,e.textColor=z.weak.color_text,F.data[this.data[t].name]||(F.data[this.data[t].name]={}),F.data[this.data[t].name][e.days[0]]=Object.keys(z).find((t=>z[t].name_display===e.name))):e.name===z.weak.name_display?(e.name=z.medium.name_display,e.backgroundColor=z.medium.color,e.textColor=z.medium.color_text,F.data[this.data[t].name]||(F.data[this.data[t].name]={}),F.data[this.data[t].name][e.days[0]]=Object.keys(z).find((t=>z[t].name_display===e.name))):e.name===z.medium.name_display?(e.name=z.strong.name_display,e.backgroundColor=z.strong.color,e.textColor=z.strong.color_text,F.data[this.data[t].name]||(F.data[this.data[t].name]={}),F.data[this.data[t].name][e.days[0]]=Object.keys(z).find((t=>z[t].name_display===e.name))):e.name===z.strong.name_display&&(e.name=z.nan.name_display,e.backgroundColor=z.nan.color,e.textColor=z.nan.color_text,delete F.data[this.data[t].name][e.days[0]],0===Object.keys(F.data[this.data[t].name]).length&&F.data[this.data[t].name].constructor===Object&&delete F.data[this.data[t].name])},uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0,a="x"==e?t:3&t|8;return a.toString(16)}))},caseId(){for(var e="",t=0;t<U;t++)e+=T.charAt(Math.floor(Math.random()*T.length));return e},generateNewIdRecorded(){this.recordedId=this.caseId()},saveRecorded(){return this.recordedId&&""!==this.recordedId||this.generateNewIdRecorded(),this.recordedId.length!==U?(console.log("invalid id."),this.textSnackbar="请输入有效ID或点击“新ID”",void(this.snackbar=!0)):0===Object.keys(F.data).length?(console.log("no data."),this.textSnackbar="请先填写数据",void(this.snackbar=!0)):(F.dateRange=this.dateRange,F.allSymptoms=this.allSymptoms,F.symptoms=this.symptoms,void j.saveData(this.recordedId,F).then((()=>{try{navigator.clipboard.writeText(this.recordedId)}catch(e){console.log(e)}this.textSnackbar="保存成功，ID已复制到剪贴板",this.snackbar=!0,this.router.replace({path:this.route.path,query:{id:this.recordedId}}),history.pushState(null,null,this.route.path+"?id="+this.recordedId)})).catch((e=>{console.log(e),this.textSnackbar="保存失败，请重试",this.snackbar=!0})))},loadRecorded(){if(!this.recordedId||""===this.recordedId||this.recordedId.length!==U)return console.log("invalid id."),this.textSnackbar="请输入有效ID",void(this.snackbar=!0);j.getData(this.recordedId).then((e=>{F.data=e.data,F.dateRange=e.dateRange,F.allSymptoms=e.allSymptoms,F.symptoms=e.symptoms,this.dateRange=F.dateRange,this.startDay=this.dateRange[0],this.endDay=this.dateRange[1],K.value=N(),this.allSymptoms=F.allSymptoms,this.symptoms=F.symptoms,this.data=this.createData(),this.textSnackbar="加载成功",this.snackbar=!0,this.router.replace({path:this.route.path,query:{id:this.recordedId}}),history.pushState(null,null,this.route.path+"?id="+this.recordedId)})).catch((e=>{console.log(e),this.textSnackbar="加载失败，请输入保存过的ID",this.snackbar=!0}))},shareRecorded(){navigator.share({title:"Share recorded data",text:"Share recorded data",url:window.location.href.split("?")[0]+(this.recordedId?"?id="+this.recordedId:"")})},copyRecordedId(){try{navigator.clipboard.writeText(this.recordedId)}catch(e){console.log(e)}this.textSnackbar=(this.recordedId?this.recordedId:"")+" 已复制至剪贴板",this.snackbar=!0}}},Q=a(89);const B=(0,Q.Z)(G,[["render",D]]);var X=B,J={name:"App",components:{MainPage:X}};const ee=(0,Q.Z)(J,[["render",d]]);var te=ee,ae=(a(9773),a(8957)),ne=(0,ae.Rd)();async function oe(){const e=await a.e(461).then(a.t.bind(a,3657,23));e.load({google:{families:["Roboto:100,300,400,500,700,900&display=swap"]}})}const re=[{path:"/",component:te}],ie=(0,W.p7)({history:(0,W.PO)("/"),routes:re});oe(),(0,n.ri)(te).use(ne).use(ie).mount("#app")}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={id:n,loaded:!1,exports:{}};return e[n](r,r.exports,a),r.loaded=!0,r.exports}a.m=e,function(){a.amdO={}}(),function(){var e=[];a.O=function(t,n,o,r){if(!n){var i=1/0;for(c=0;c<e.length;c++){n=e[c][0],o=e[c][1],r=e[c][2];for(var d=!0,s=0;s<n.length;s++)(!1&r||i>=r)&&Object.keys(a.O).every((function(e){return a.O[e](n[s])}))?n.splice(s--,1):(d=!1,r<i&&(i=r));if(d){e.splice(c--,1);var l=o();void 0!==l&&(t=l)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[n,o,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};a.t=function(n,o){if(1&o&&(n=this(n)),8&o)return n;if("object"===typeof n&&n){if(4&o&&n.__esModule)return n;if(16&o&&"function"===typeof n.then)return n}var r=Object.create(null);a.r(r);var i={};e=e||[null,t({}),t([]),t(t)];for(var d=2&o&&n;"object"==typeof d&&!~e.indexOf(d);d=t(d))Object.getOwnPropertyNames(d).forEach((function(e){i[e]=function(){return n[e]}}));return i["default"]=function(){return n},a.d(r,i),r}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,n){return a.f[n](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/webfontloader.16ab3cf3.js"}}(),function(){a.miniCssF=function(e){}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.hmd=function(e){return e=Object.create(e),e.children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e}}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="symptom_timeline:";a.l=function(n,o,r,i){if(e[n])e[n].push(o);else{var d,s;if(void 0!==r)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+r){d=u;break}}d||(s=!0,d=document.createElement("script"),d.charset="utf-8",d.timeout=120,a.nc&&d.setAttribute("nonce",a.nc),d.setAttribute("data-webpack",t+r),d.src=n),e[n]=[o];var m=function(t,a){d.onerror=d.onload=null,clearTimeout(h);var o=e[n];if(delete e[n],d.parentNode&&d.parentNode.removeChild(d),o&&o.forEach((function(e){return e(a)})),t)return t(a)},h=setTimeout(m.bind(null,void 0,{type:"timeout",target:d}),12e4);d.onerror=m.bind(null,d.onerror),d.onload=m.bind(null,d.onload),s&&document.head.appendChild(d)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/"}(),function(){var e={143:0};a.f.j=function(t,n){var o=a.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var r=new Promise((function(a,n){o=e[t]=[a,n]}));n.push(o[2]=r);var i=a.p+a.u(t),d=new Error,s=function(n){if(a.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var r=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;d.message="Loading chunk "+t+" failed.\n("+r+": "+i+")",d.name="ChunkLoadError",d.type=r,d.request=i,o[1](d)}};a.l(i,s,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,r,i=n[0],d=n[1],s=n[2],l=0;if(i.some((function(t){return 0!==e[t]}))){for(o in d)a.o(d,o)&&(a.m[o]=d[o]);if(s)var c=s(a)}for(t&&t(n);l<i.length;l++)r=i[l],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(c)},n=self["webpackChunksymptom_timeline"]=self["webpackChunksymptom_timeline"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(8891)}));n=a.O(n)})();
//# sourceMappingURL=app.c9d3a7d9.js.map